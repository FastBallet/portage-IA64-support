SHELL = @PORTAGE_BASH@

prefix = @prefix@
sysconfdir = @sysconfdir@
datadir = @datadir@

srcdir = @srcdir@
top_builddir = @top_builddir@
PORTAGE_CONF = $(datadir)/portage/config

portageuser = @portageuser@
portagegroup = @portagegroup@

INSTALL = @INSTALL@
INSTALL_subst = ${top_builddir}/subst-install --hprefixify
LN_S = @LN_S@

all:

install:
	$(INSTALL) -d -m 755 -o "$(portageuser)" -g "$(portagegroup)" $(DESTDIR)$(PORTAGE_CONF)
	$(INSTALL_subst) \
		-o "$(portageuser)" -g "$(portagegroup)" \
		-t "$(DESTDIR)$(PORTAGE_CONF)" \
		"$(srcdir)"/make.globals "$(srcdir)"/repos.conf
	$(INSTALL) -d -m 755 -o "$(portageuser)" -g "$(portagegroup)" $(DESTDIR)$(PORTAGE_CONF)/sets
	$(INSTALL_subst) \
		-o "$(portageuser)" -g "$(portagegroup)" \
		-t "$(DESTDIR)$(PORTAGE_CONF)/sets" \
		"$(srcdir)"/sets/portage.conf
	$(INSTALL_subst) \
		-o "$(portageuser)" -g "$(portagegroup)" \
		"$(srcdir)"/make.conf.example "$(DESTDIR)$(PORTAGE_CONF)"/make.conf.example
	$(INSTALL) -d -m 755 -o "$(portageuser)" -g "$(portagegroup)" $(DESTDIR)$(sysconfdir)
	$(INSTALL_subst) \
		-o "$(portageuser)" -g "$(portagegroup)" \
		-t "$(DESTDIR)$(sysconfdir)" \
		"$(srcdir)"/dispatch-conf.conf \
		"$(srcdir)"/etc-update.conf
	( cd $(DESTDIR)$(sysconfdir) && rm -f make.globals && $(LN_S) $(DESTDIR)$(PORTAGE_CONF)/make.globals )

.PHONY:	all install
